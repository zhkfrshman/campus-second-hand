<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<body>
<div th:replace="fragments/header :: *"></div>

<div class="row">
    <div class="col-md-6">
        <img th:src="${product.image}" class="img-fluid" alt="图片"/>
    </div>
    <div class="col-md-6">
        <h3 th:text="${product.name}">商品名</h3>
        <h4>¥ <span th:text="${product.price}">0.00</span></h4>
        <p th:text="${product.remark}">描述</p>

        <!-- 简单加入购物车：填写 uid 参数（开发阶段可手动传 uid） -->
        <div class="mb-3">
            <label>UID（开发时手动填用户 id）</label>
            <input id="cart-uid" class="form-control" placeholder="例如 1"/>
        </div>
        <button class="btn btn-success" id="btn-add-cart" th:attr="data-sid=${product.id}">加入购物车</button>

        <div id="cart-result" class="mt-2"></div>
    </div>
</div>

<hr/>

<h5>留言</h5>
<div th:each="m : ${messages}">
    <div><strong th:text="${m.uid}">user</strong>：<span th:text="${m.content}"></span></div>
</div>

<div th:replace="fragments/footer :: *"></div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const btn = document.getElementById('btn-add-cart');
        btn.addEventListener('click', async () => {
            const sid = btn.getAttribute('data-sid');
            const uid = document.getElementById('cart-uid').value;
            if(!uid){ alert('请填写 UID（开发时）'); return; }
            try {
                const res = await fetch('/cart/add', {
                    method: 'POST',
                    headers: {'Content-Type':'application/x-www-form-urlencoded'},
                    body: `uid=${encodeURIComponent(uid)}&sid=${encodeURIComponent(sid)}&qty=1`
                });
                const text = await res.text();
                document.getElementById('cart-result').innerText = text === 'OK' ? '已加入购物车' : text;
            } catch (e) {
                document.getElementById('cart-result').innerText = '请求失败';
            }
        });
    });
</script>
</html>
